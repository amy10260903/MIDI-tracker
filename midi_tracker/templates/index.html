{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Noto+Sans+TC:wght@300&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="{% static 'js/handler.js' %}"></script>
    <script src="{% static 'js/api.js' %}"></script>
</head>
<body>
<section class="header">
    <img src="{% static 'images/icon-midi.png' %}">
    <div class="text">
        <div class="title">MIDI Tracker</div>
        <div class="description">Generate chord tracks with a MIDI chord</div>
    </div>
</section>
<section class="main">
  <div class="container">
      <form class="upload-box" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
          <img src="{% static 'images/icon-upload.png' %}">
          <div class="text" id="file-drop">
              Drag &amp; Drop to Upload File <br/>
              OR
          </div>
          <input type="file" id="file-upload" hidden></input>
          <label for="file-upload" class="button">Browse File</label>
      </form>
      <div class="file-box">
          <div class="button" onclick="submitForm(event)">Submit</div>
      </div>
  </div>
</section>
<script>
    let formData = new FormData();
    let csrftoken = '{{ csrf_token }}'
    let base_url = '{{ base_url }}'
    $('.file-box').hide();

    function showFileList() {
        $('.upload-box').hide();
        $('.file-box').show();
    }

    function addFile(file) {
        $('.file-box').prepend(`<div class="text"><img src="{% static 'images/icon-file.png' %}"><div>${file.name}</div></div>`)
        formData.append('file', file);
    }

    $('#file-upload').change(function() {
        console.log('File(s) uploaded');

        $.each(this.files, function(i, file) {
            console.log(`â€¦ file[${i}].name = ${file.name}`);
            addFile(file);
        })
        showFileList();
    })
    function submitForm(ev) {
        ev.preventDefault();
        console.log('submit')
        console.log(formData.get('file'));

        let url = `${base_url}/api/upload/`
        formData.append('csrfmiddlewaretoken', csrftoken);
        fetch(url, {
            method: 'POST',
            body: formData
        }).then((response) => {
            console.log(response);
        }).catch(() => {

        })
    }
</script>
</body>
</html>